<?xml version="1.0"?>
<project name="GcTour" default="copytofirefox" basedir=".">
	<property name="App" value="gc_tour" />
	<property name="src.dir" value="src" />
	<property name="build.dir" value="build" />	
	<property name="tmp.dir" value="tmp" />
	<property name="GcTour.dir" value="/home/martin/.mozilla/firefox/zxeaqutn.default/gm_scripts/gc_tour" />
	
	
	
	
	<target name="concatenate" description="Concatenate all js files">
		<echo>Concat all sources to a script.</echo>
		<concat destfile="${tmp.dir}/${App}.user.js" fixlastline="yes">
			<fileset dir="${src.dir}/" includes="*.js" excludes="00-header.js" />
		</concat>

		
	</target>

	<target name="compress" depends="concatenate" description="Compress application.js to application-min.js">
		<echo>Compress script.</echo>
		<apply executable="java" parallel="false">
			<filelist dir="${tmp.dir}" files="${App}.user.js" />
			<arg line="-jar" />
			<arg path="compressor/yuicompressor-2.4.2.jar" />
			<srcfile />
			<arg line="-o" />
			<mapper type="glob" from="${App}.user.js" to="${tmp.dir}/${App}-min.user.js" />
			<targetfile />
		</apply>
	</target>
	
	<target name="addheader" depends="compress" description="Add Userscript-Header to the Script.">
		<echo>Add Userscript-Header to the script.</echo>
		<concat destfile="${build.dir}/${App}.user.js" fixlastline="yes">
		    <fileset file="${src.dir}/00-header.js" />
			<fileset file="${tmp.dir}/${App}.user.js" />
		</concat>
		<delete file="${tmp.dir}/${App}.user.js"/>
		
		<echo>Add Userscript-Header to the compressed script.</echo>
		<concat destfile="${build.dir}/${App}-min.user.js" fixlastline="yes">
		    <fileset file="${src.dir}/00-header.js" />
			<fileset file="${tmp.dir}/${App}-min.user.js" />
		</concat>
		<delete file="${tmp.dir}/${App}-min.user.js"/>		
	</target>
	
	
	<target name="copytofirefox" depends="addheader" description="Copies the script to the GM_SCRIPTS folder in your firefox. Not enabled by default.">
		<copy todir="${GcTour.dir}/">
			<fileset dir="${build.dir}/" includes="${App}.user.js" />
		</copy>
	</target>
</project> 
